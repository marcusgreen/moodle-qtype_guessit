{"version":3,"file":"gapsnavigation.min.js","sources":["../src/gapsnavigation.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript code for the gapfill question type.\n *\n * @copyright  2024 Joseph RÃ©zeau\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module qtype_guessit/gapsnavigation\n *\n * This script controls navigation in the GuessIt game.\n */\n\n/**\n * Initialize the input gaps functionalities.\n */\nexport function init() {\n    /* eslint-disable no-unused-vars */\n    /* eslint-disable no-unused-vars */\n    /* eslint-disable no-console */\n\n    // Make correctly filled in gaps readonly\n    const correctGaps = document.querySelectorAll('input.correct');\n    correctGaps.forEach((input) => {\n      input.readOnly  = true; // Make the input readonly.\n      input.style.cursor = \"not-allowed\"; // Set the cursor style.\n    });\n    document.querySelectorAll('[id^=\"question-\"]').forEach(question => {\n        const gaps = question.querySelectorAll('input[type=\"text\"][name*=\"p\"]');\n        const checkButton = question.querySelector('button[type=\"submit\"].submit');\n\n        gaps.forEach((element, index) => {\n            // Prevent space from being entered and conditionally move focus\n            element.addEventListener(\"keydown\", (event) => {\n                if (event.key === ' ' || (event.key === 'Tab' && !event.shiftKey)) {\n                    event.preventDefault();\n                    // Only move to the next gap if the current one is not empty\n                    if (element.value.trim() !== '') {\n                        let nextIndex = index + 1;\n                        // Skip over any gaps with class \"correct\"\n                        while (nextIndex < gaps.length && gaps[nextIndex].classList.contains('correct')) {\n                            nextIndex++;\n                        }\n                        if (nextIndex < gaps.length) {\n                            // Move to the next non-\"correct\" gap\n                            var nextGap = gaps[nextIndex];\n                            nextGap.focus();\n                            var length = nextGap.value.length;\n                            nextGap.setSelectionRange(length, length);\n                            if (gaps[nextIndex].classList.contains('incorrect') ) {\n                                gaps[nextIndex].value = '';\n                                gaps[nextIndex].classList.remove('incorrect');\n                            }\n                        } else if (checkButton) {\n                            // If it's the last gap in the question, move focus to the \"Check\" button\n                            checkButton.focus();\n                        }\n                    }\n                }\n            });\n            element.addEventListener(\"click\", () => {\n                if (element.classList.contains('incorrect')) {\n                    element.value = ''; // Empty the incorrect gap value on click\n                    element.classList.remove('incorrect'); // And remove the incorrect class\n                }\n            });\n            if (element.classList.contains('auto-grow-input')) {\n                // Enable the input fields auto-grow feature (if set in the question options)\n                element.addEventListener(\"input\", function () {\n                    element.style.width = \"auto\"; // Reset width\n                    // Set the width to the content size plus 1 px for adjustment.\n                    element.style.width = (element.scrollWidth + 1) + \"px\";\n                });\n                // Trigger the event on page load to adjust the input width for pre-filled values\n                element.dispatchEvent(new Event('input'));\n            }\n        });\n    });\n\n}"],"names":["document","querySelectorAll","forEach","input","readOnly","style","cursor","question","gaps","checkButton","querySelector","element","index","addEventListener","event","key","shiftKey","preventDefault","value","trim","nextIndex","length","classList","contains","nextGap","focus","setSelectionRange","remove","width","scrollWidth","dispatchEvent","Event"],"mappings":";;;;;;;AA+BO,WAMiBA,SAASC,iBAAiB,iBAClCC,SAASC,QACnBA,MAAMC,UAAY,EAClBD,MAAME,MAAMC,OAAS,aAAa,IAEpCN,SAASC,iBAAiB,qBAAqBC,SAAQK,WACnD,MAAMC,KAAOD,SAASN,iBAAiB,iCACjCQ,YAAcF,SAASG,cAAc,gCAE3CF,KAAKN,SAAQ,CAACS,QAASC,SAEnBD,QAAQE,iBAAiB,WAAYC,QACjC,IAAkB,MAAdA,MAAMC,KAA8B,QAAdD,MAAMC,MAAkBD,MAAME,YACpDF,MAAMG,iBAEuB,KAAzBN,QAAQO,MAAMC,QAAe,CAC7B,IAAIC,UAAYR,MAAQ,EAExB,KAAOQ,UAAYZ,KAAKa,QAAUb,KAAKY,WAAWE,UAAUC,SAAS,YACjEH,YAEJ,GAAIA,UAAYZ,KAAKa,OAAQ,CAEzB,IAAIG,QAAUhB,KAAKY,WACnBI,QAAQC,QACR,IAAIJ,OAASG,QAAQN,MAAMG,OAC3BG,QAAQE,kBAAkBL,OAAQA,QAC9Bb,KAAKY,WAAWE,UAAUC,SAAS,eACnCf,KAAKY,WAAWF,MAAQ,GACxBV,KAAKY,WAAWE,UAAUK,OAAO,aAExC,MAAUlB,aAEPA,YAAYgB,OAEpB,CACJ,IAEJd,QAAQE,iBAAiB,SAAS,KAC1BF,QAAQW,UAAUC,SAAS,eAC3BZ,QAAQO,MAAQ,GAChBP,QAAQW,UAAUK,OAAO,aAC7B,IAEAhB,QAAQW,UAAUC,SAAS,qBAE3BZ,QAAQE,iBAAiB,SAAS,WAC9BF,QAAQN,MAAMuB,MAAQ,OAEtBjB,QAAQN,MAAMuB,MAASjB,QAAQkB,YAAc,EAAK,IACtD,IAEAlB,QAAQmB,cAAc,IAAIC,MAAM,UACpC,GACF,GAGV,CAAC"}